---
title: 모던 자바 인 액션 - 11장 null 대신 Optional 클래스
description: 모던 자바 인 액션 - 11장 null 대신 Optional 클래스
categories:
 - dev
tags:
 - java
comments: true
---
> Modern Java In Action 정리 - null 대신 Optional 클래스

  * null 참조의 문제점과 null을 멀리해야 하는 이유
  * null 대신 Optional : null로부터 안전한 도메인 모델 재구현하기
  * Optional 활용 : null 확인 코드 제거하기
  * Optinoal에 저장된 값을 확인하는 방법
  * 값이 없을 수도 있는 상황을 고려하는 프로그래밍

`모던 자바 인 액션 책을 보고 정리한 글입니다.` 

작성중인 글입니다. 

## 값이 없는 상황을 어떻게 처리할까 ?

* 다음 처럼 자동차와 자동차 보험을 갖고 있는 사람 객체를 중첩으로 구현했다고 가정

```java
public class Person {
    private Car car;

    public Car getCar() {
        return car;
    }
}

public class Car {
    private Insurance insurance;

    public Insurance getInsurance() {
        return insurance;
    }
}

public class Insurance {
    private String name;

    public String getName() {
        return name;
    }
}

```

* 다음 코드에서는 어떤 문제가 발생할까 ?

```java
public String getCarInsuranceName(Person person) {
    return person.getCar().getInsurance().getName();
}
```
* 코드상 문제는 없어 보이지만 자동차를 소유하지 않은 사람이 있을수도, 보험에 들지 않은 사람이 있을수도 있다. 

### 보수적인 자세로 NullPointerException 줄이기
* 예기치 않은 NPE를 피하려면 보수적인 코드를 추가해야 할것이다. 

```java
public String getCarInsuranceName(Person person) {
    if (person != null) {
        Car car = person.getCar();
        if (car != null) {
            Insurance insurance = car.getInsurance();
            if (insurance != null) {
                return insurance.getName();
            }
        }
    }
    return "Unknown";
}
```

* 위 예제 에서는 모든 변수가 null 체크를 하기 때문에 코드가 지저부해지고 반복패턴이 많아진다. 이러한 코드를 Deep Doubt 라고 부른다. 
* 뭔가 다른 해결 방법이 시급해 보인다. 

```java
public String getCarInsuranceName(Person person) {
    if (person == null) {
        return "Unknown";    
    }

    Car car = person.getCar();
    if (car == null) {
        return "Unknown";
    }

    Insurance insurance = car.getInsurance();
    if (insurance == null) {
        return "Unknown";
    }
    return insurance.getName();
}
```

* 위 코드는 null 일 경우 바로 값을 반환 하도록 변경했다. 하지만 return 을 할수 있는 통로가 너무 많기 때문에 유지보수가 어려워지고 다른 누군가가 null일수 있다는 사실을 까먹는 경우 NPE는 여전히 발생할 것이다. 

### null 때문에 발생하는 문제
* 에러의 근원이다.
  * NPE는 자바에서 가장 흔히 발생하는 에러이다. 
* 코드를 어지럽힌다.
  * Null 체크를 빈번히 하게되면 코드가 지저분해진다.
* 아무 의미가 없다. 
  * Null 은 아무 의미도 표현하지 않는다. 특히 정적 형식 언어에서 값이 없음을 표현하는 방법으로 적합하지 않다. 
* 자바 철학에 위배된다. 
  * 자바는 개발자로부터 모든 포인터를 숨겼다. 하지만 예외가 Null이다.
* 형식 시스템에 구멍을 만든다. 
  * Null은 무형식이며 정보를 포함하지 않고 있기 때문에 모든 참조 형식에 Null을 할당할 수 있다. 
