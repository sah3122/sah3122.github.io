---
title: 모던 자바 인 액션 - 16장 CompletableFuture - 안정적 비동기 프로그래밍
description: 모던 자바 인 액션 - 16장 CompletableFuture - 안정적 비동기 프로그래밍
categories:
 - dev
tags:
 - java
comments: true
---
> Modern Java In Action 정리 - CompletableFuture - 안정적 비동기 프로그래밍

  * 비동기 작업을 만들고 결과 얻기
  * 비블록 동작으로 생산성 높이기
  * 비동기 API 설계와 구현
  * 동기 API를 비동기적으로 소비하기
  * 두 개 이상의 비동기 연산을 파이프라인으로 만들고 합치기
  * 비동기 작업 완료에 대응하기

`모던 자바 인 액션 책을 보고 정리한 글입니다.` 

작성중인 글입니다.

## Future의 단순활용
* Java 5 부터 미래의 어느 시점에 결과를 얻는 모델에 활용할수 있도록 Future 인터페이스를 제공하고 있다. 
* 시간이 걸리는 작업들을 Future 내부에 설정하여 호출자 스레드가 결과를 기다리는 동안 다른 유용한 작업들을 할 수 있다. 

```java
ExecutorService es =ex.newCachedThreadPool();
Future<Double> future = ex.submit(new Callable<Double>() {
  public Double call() {
    return doSomeLongComputation();
  }
})
doSomeThingElse();
future.get(1, TimeUnit.SECONDS); // 비동기 결과가 준비되어 있지 않으면 1초간 기다린다. 
```

* 위 예재와 같이 시간이 오래 걸리는 작업을 다른 스레드에서 처리하고 메인 스레드에서는 다른 작업들을 미리 수행할 수 있다. 
* 만약 결과가 준비되지 않았다면 작업이 완료될때까지 스레드를 블록할 수 있다. 이때 영원히 스레드가 종료되지 않는 경우를 대비하여 최대 타임아웃을 설정가능하다. 

### Future 제한
* 첫번째 예제에서는 Future 인터페이스가 비동기 계산이 끝났는지 확인할수 있는 isDone, 게산이 끝나길 기다리는 메서드, 결과 회수 메서드등을 제공한다. 하지만 이들만으로 동시 실행 코드를 구현하기 어렵다. 
* 오래걸리는 A 계산이 끝나면 B를 실행하라 와 같은 요구사항을 쉽게 구현할 수 있어야 한다. 
* Future로 이와같은 동작을 구현하는것은 쉽지 않다. 다음과 같은 선언형 기능이 있다면 유용하게 사용할 수 있을것이다. 
  * 두 개의 비동기 계산 결과를 하나로 합친다. 두 계산은 하나에 의존하는 상황일수도, 독립적인 계산일수도 있다. 
  * Future 집합이 샐행하는 모든 테스크의 완료를 기다린다. 
  * Future 집합에서 가장 빨리 완료되는 테스크를 기다렸다가 결과를 얻는다. (예를 들어 여러 테스크가 다양한 방식으로 같은 결과를 얻는 방법)
  * 프로그램적으로 Future를 완료 시킨다. (비동기 동작에 수동으로 결과 제공)
  * Future 완료 동작에 반응한다. (결과를 기다리며 블록되지 않고 결과가 준비되었다는 알림을 받은 다음 Future의 결과로 원하는 추가 동작을 수행가능)
* 선언형으로 Future를 사용할 수 있는 CompletableFuture 클래스에 대해 알아본다.
* Stream과 비슷하게 람다표현식과 파이프라이닝을 활용, 따라서 Future와 CompletableFuture는 Collection과 Stream의 관계에 비유가능하다. 

### CompletableFuture로 비동기 애플리케이션 만들기
* 첫쨰. 고객에게 비동기 API를 제공하는 방법을 배운다. 
* 둘쨰. 동기 API를 사용해야할 때 코드를 비블록으로 만드는 방법을 배운다. 두 개의 비동기 동작을 파이프라인으로 만드는 방법과 두 개의 동작 결과를 하나의 비동기 계산으로 합치는 방법.
* 셋째. 비동기 동작의 완료에 대응하는 방법을 배운다.